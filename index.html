<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>TEAM RAIDEN 推しプロフィール - 入力</title>
  <style>
    body {
      margin: 0; padding: 0;
      font-family: sans-serif;
    }
    main {
      max-width: 600px;
      margin: 20px auto;
      padding: 0 20px;
    }
    h1 {
      text-align: center;
      color: #FFD700;
      margin-bottom: 20px;
    }
    .profile-container {
      background: #fff;
      border: 2px solid #FFD700;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 1px 1px 6px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      font-weight: bold;
      margin-bottom: 4px;
      color: #333;
    }
    input[type="text"],
    input[type="number"],
    textarea,
    select,
    input[type="file"] {
      width: 100%;
      box-sizing: border-box;
      margin-bottom: 12px;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      background-color: #FFD700;
      color: #000;
      font-weight: bold;
      padding: 10px 20px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      margin: 10px 5px 0;
    }
    button:hover {
      background: #ffec8c;
    }
    #status {
      margin-top: 10px;
      color: #f00;
      font-weight: bold;
    }
  </style>
</head>
<body>
<main>
  <h1>TEAM RAIDEN 推しプロフィール - 入力</h1>

  <div class="profile-container">
    <h2>推し情報</h2>
    <label>推し選手を選択(必須)</label>
    <select id="playerSelect" required>
      <option value="" disabled selected>選択してください</option>
      <option>萩原聖人</option>
      <option>瀬戸熊直樹</option>
      <option>黒沢咲</option>
      <option>本田朋広</option>
      <option>全員を推す</option>
    </select>

    <label>推し選手の好きな写真(メインのみ)</label>
    <input type="file" id="photo" accept="image/*">

    <label>推しの呼び方(10文字)</label>
    <input type="text" id="nickname" maxlength="10">

    <label>好きなところ(13文字)</label>
    <input type="text" id="favoriteThing" maxlength="13">

    <label>好きになったきっかけ(18文字)</label>
    <input type="text" id="fanReason" maxlength="18">

    <label>推しのここを知ってほしい(12文字)</label>
    <input type="text" id="highlight" maxlength="12">
  </div>

  <div class="profile-container">
    <h2>性格チャート</h2>
    <label>クール</label>
    <input type="number" id="cool" value="0">
    <label>かわいい</label>
    <input type="number" id="cute" value="0">
    <label>優しい</label>
    <input type="number" id="kind" value="0">
    <label>面白い</label>
    <input type="number" id="funny" value="0">
    <label>強い</label>
    <input type="number" id="strong" value="0">
  </div>

  <div class="profile-container">
    <h2>ベストメモリーズ</h2>
    <label>推しとの一番の思い出(72文字)</label>
    <textarea id="memory1" rows="3" maxlength="72"></textarea>
    <label>推しが一番輝いて見えたのは(72文字)</label>
    <textarea id="memory2" rows="3" maxlength="72"></textarea>
  </div>

  <div class="profile-container">
    <h2>ifトーク</h2>
    <label>学校の先生にするなら</label>
    <select id="teacher">
      <option value="" disabled selected>選択してください</option>
      <option>萩原聖人</option>
      <option>瀬戸熊直樹</option>
      <option>黒沢咲</option>
      <option>本田朋広</option>
    </select>
    <label>一緒に無人島行くなら</label>
    <select id="island">
      <option value="" disabled selected>選択してください</option>
      <option>萩原聖人</option>
      <option>瀬戸熊直樹</option>
      <option>黒沢咲</option>
      <option>本田朋広</option>
    </select>
    <label>上司にするなら</label>
    <select id="boss">
      <option value="" disabled selected>選択してください</option>
      <option>萩原聖人</option>
      <option>瀬戸熊直樹</option>
      <option>黒沢咲</option>
      <option>本田朋広</option>
    </select>
    <label>後輩にするなら</label>
    <select id="junior">
      <option value="" disabled selected>選択してください</option>
      <option>萩原聖人</option>
      <option>瀬戸熊直樹</option>
      <option>黒沢咲</option>
      <option>本田朋広</option>
    </select>
  </div>

  <div class="profile-container">
    <h2>家族に例えるなら</h2>
    <label>父</label>
    <select id="family-father">
      <option value="" disabled selected>選択してください</option>
      <option>萩原聖人</option>
      <option>瀬戸熊直樹</option>
      <option>黒沢咲</option>
      <option>本田朋広</option>
    </select>
    <label>母</label>
    <select id="family-mother">
      <option value="" disabled selected>選択してください</option>
      <option>萩原聖人</option>
      <option>瀬戸熊直樹</option>
      <option>黒沢咲</option>
      <option>本田朋広</option>
    </select>
    <label>兄</label>
    <select id="family-brother">
      <option value="" disabled selected>選択してください</option>
      <option>萩原聖人</option>
      <option>瀬戸熊直樹</option>
      <option>黒沢咲</option>
      <option>本田朋広</option>
    </select>
    <label>姉</label>
    <select id="family-sister">
      <option value="" disabled selected>選択してください</option>
      <option>萩原聖人</option>
      <option>瀬戸熊直樹</option>
      <option>黒沢咲</option>
      <option>本田朋広</option>
    </select>
    <label>弟</label>
    <select id="family-younger-brother">
      <option value="" disabled selected>選択してください</option>
      <option>萩原聖人</option>
      <option>瀬戸熊直樹</option>
      <option>黒沢咲</option>
      <option>本田朋広</option>
    </select>
    <label>妹</label>
    <select id="family-younger-sister">
      <option value="" disabled selected>選択してください</option>
      <option>萩原聖人</option>
      <option>瀬戸熊直樹</option>
      <option>黒沢咲</option>
      <option>本田朋広</option>
    </select>
    <label>ペット</label>
    <select id="family-pet">
      <option value="" disabled selected>選択してください</option>
      <option>萩原聖人</option>
      <option>瀬戸熊直樹</option>
      <option>黒沢咲</option>
      <option>本田朋広</option>
    </select>
  </div>

  <div class="profile-container">
    <h2>推しへのメッセージ(148文字)</h2>
    <textarea id="message" rows="3" maxlength="148"></textarea>
  </div>

  <div class="profile-container" style="text-align: center;">
    <button id="goPreviewBtn">2ページ目(プレビュー)へ</button>
    <p id="status"></p>
  </div>
</main>

<script>
document.addEventListener('DOMContentLoaded', ()=>{
  const goPreviewBtn = document.getElementById('goPreviewBtn');
  const photoInput   = document.getElementById('photo');
  const statusEl     = document.getElementById('status');

  goPreviewBtn.addEventListener('click', ()=>{
    statusEl.textContent = "画像処理中...";

    const dataObj = gatherFormData();
    // 推し選手の写真(アップロード)をBase64化
    const file = photoInput.files[0];
    if(!file){
      dataObj.photoDataURL = "";
      saveAndGoPreview(dataObj);
      return;
    }
    const rdr = new FileReader();
    rdr.onload = e => {
      const originalUrl = e.target.result;
      if(!originalUrl){
        dataObj.photoDataURL = "";
        saveAndGoPreview(dataObj);
        return;
      }
      // そのまま使う or 圧縮処理してもOK
      dataObj.photoDataURL = originalUrl; 
      saveAndGoPreview(dataObj);
    };
    rdr.onerror = ()=>{
      statusEl.textContent = "画像読み込み失敗";
      dataObj.photoDataURL = "";
      saveAndGoPreview(dataObj);
    };
    rdr.readAsDataURL(file);
  });

  function gatherFormData(){
    return {
      playerSelect     : val('playerSelect'),
      photoDataURL     : "",
      nickname         : val('nickname'),
      favoriteThing    : val('favoriteThing'),
      fanReason        : val('fanReason'),
      highlight        : val('highlight'),
      cool             : parseNum('cool'),
      cute             : parseNum('cute'),
      kind             : parseNum('kind'),
      funny            : parseNum('funny'),
      strong           : parseNum('strong'),
      memory1          : val('memory1'),
      memory2          : val('memory2'),
      teacher          : val('teacher'),
      island           : val('island'),
      boss             : val('boss'),
      junior           : val('junior'),
      father           : val('family-father'),
      mother           : val('family-mother'),
      brother          : val('family-brother'),
      sister           : val('family-sister'),
      youngerBrother   : val('family-younger-brother'),
      youngerSister    : val('family-younger-sister'),
      pet              : val('family-pet'),
      message          : val('message')
    };
  }

  function val(id){
    const el = document.getElementById(id);
    return el ? el.value.trim() : "";
  }
  function parseNum(id){
    const raw = val(id);
    if(!raw)return 0;
    const n = parseFloat(raw);
    return isNaN(n) ? 0 : n;
  }

  function saveAndGoPreview(obj){
    localStorage.setItem('raidenProfileData', JSON.stringify(obj));
    window.location.href="preview.html";
  }
});
</script>
</body>
</html>
